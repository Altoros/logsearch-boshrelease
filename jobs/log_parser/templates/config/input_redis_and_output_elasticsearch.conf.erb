input {
    <% if_p('kafka.zookeeper') do %>
        kafka {
            zk_connect => '<%= p('kafka.zookeeper').join(',') %>'
            topic_id => '<%= p('kafka.topic') %>'
            reset_beginning => true
            decorate_events => false
            consumer_id => 'log_parser.<%= name %>.<%= index %>'
        }
    <% end %>

    <% if_p('redis.host') do %>
        redis {
            host => "<%= p("redis.host") %>"
            port => "<%= p("redis.port") %>"
            type => "redis-input"
            data_type => "list"
            key => "<%= p("redis.key") %>"
            threads => 8
        }
    <% end %>
}

output {
    <% if p("logstash_parser.debug") %>
        stdout {
            codec => "json"
        }
    <% end %>

    elasticsearch_http {
        host => "<%= p("elasticsearch.host") %>:<%= p("elasticsearch.port") %>"
        flush_size => <%= p("elasticsearch.flush_size") %>
        <% if p('logstash_parser.idle_flush_time', nil) %>
            idle_flush_time => <%= p('logstash_parser.idle_flush_time') %>
        <% end %>
        index_type => "%{@type}"
        manage_template => false
    }
}
